<Page
    x:Class="TranslucentTB.Xaml.Pages.FramelessPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:root="using:TranslucentTB.Xaml"
    xmlns:controls="using:TranslucentTB.Xaml.Controls"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Background>
        <AcrylicBrush BackgroundSource="HostBackdrop" TintColor="{ThemeResource SystemAltHighColor}" TintOpacity="0.3" FallbackColor="{ThemeResource SystemChromeLowColor}" />
    </Page.Background>

    <!-- This relies on the order of controls, be careful -->
    <RelativePanel x:DefaultBindMode="OneWay">
        <ContentPresenter
            x:Name="Content"
            Content="{x:Bind UserContent}"
            RelativePanel.Below="Titlebar"
            RelativePanel.AlignBottomWithPanel="True"
            RelativePanel.AlignLeftWithPanel="True"
            RelativePanel.AlignRightWithPanel="True" />
        <Border
            x:Name="Titlebar"
            Height="29"
            Visibility="{x:Bind root:FunctionalConverters.InvertedBoolToVisibility(ExpandIntoTitlebar)}"
            RelativePanel.AlignTopWithPanel="True"
            RelativePanel.AlignLeftWithPanel="True"
            RelativePanel.AlignRightWithPanel="True">
            <Border.Background>
                <AcrylicBrush BackgroundSource="HostBackdrop" TintColor="{ThemeResource SystemChromeAltHighColor}" TintOpacity="0.7" FallbackColor="{ThemeResource SystemAltHighColor}" />
            </Border.Background>
        </Border>
        <TextBlock
            x:Name="TitleText"
            Text="{x:Bind Title}"
            FontSize="12"
            VerticalAlignment="Center"
            Padding="9,0"
            TextLineBounds="Tight"
            Visibility="{x:Bind root:FunctionalConverters.InvertedBoolToVisibility(ExpandIntoTitlebar)}"
            RelativePanel.LeftOf="CustomTitlebarControls"
            RelativePanel.AlignTopWithPanel="True"
            RelativePanel.AlignLeftWithPanel="True"
            RelativePanel.AlignBottomWith="Titlebar" />
        <ItemsControl
            x:Name="CustomTitlebarControls"
            ItemsSource="{x:Bind TitlebarContent}"
            IsTabStop="False"
            RelativePanel.AlignTopWithPanel="True"
            RelativePanel.LeftOf="CloseButton">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
        </ItemsControl>
        <controls:ChromeButton
            x:Name="CloseButton"
            Visibility="{x:Bind IsClosable}"
            Click="CloseButtonClicked"
            Style="{ThemeResource CloseButtonStyle}"
            ToolTipService.ToolTip="Close"
            RelativePanel.AlignTopWithPanel="True"
            RelativePanel.AlignRightWithPanel="True">
            <FontIcon Glyph="&#xE8BB;" FontSize="10" />
        </controls:ChromeButton>
    </RelativePanel>
</Page>
